!function(){"use strict";var a={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188},b=angular.module("ngTagsInput",[]);b.directive("tagsInput",["$timeout","$document","tagsInputConfig",function(b,c,d){function e(){var a={};return{on:function(b,c){a[b]||(a[b]=[]),a[b].push(c)},trigger:function(b,c){angular.forEach(a[b],function(a){a.call(null,c)})}}}return{restrict:"E",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(a,b,c){var f,g=new e;d.load(a,b,{customClass:{type:String,defaultValue:""},placeholder:{type:String,defaultValue:"Add a tag"},tabindex:{type:Number},removeTagSymbol:{type:String,defaultValue:String.fromCharCode(215)},replaceSpacesWithDashes:{type:Boolean,defaultValue:!0},minLength:{type:Number,defaultValue:3},maxLength:{type:Number},addOnEnter:{type:Boolean,defaultValue:!0},addOnSpace:{type:Boolean,defaultValue:!1},addOnComma:{type:Boolean,defaultValue:!0},addOnBlur:{type:Boolean,defaultValue:!0},allowedTagsPattern:{type:RegExp,defaultValue:/^[a-zA-Z0-9\s]+$/},enableEditingLastTag:{type:Boolean,defaultValue:!1}}),g.on("tag-added",a.onTagAdded),g.on("tag-removed",a.onTagRemoved),a.newTag="",a.tags=a.tags||[],a.tryAdd=function(){var b=!1,c=a.newTag;return c.length>=a.options.minLength&&a.options.allowedTagsPattern.test(c)&&(a.options.replaceSpacesWithDashes&&(c=c.replace(/\s/g,"-")),-1===a.tags.indexOf(c)&&(a.tags.push(c),g.trigger("tag-added",{$tag:c})),a.newTag="",g.trigger("input-changed",""),b=!0),b},a.tryRemoveLast=function(){var b=!1;return a.tags.length>0&&(a.options.enableEditingLastTag?a.newTag=a.remove(a.tags.length-1):f?(a.remove(a.tags.length-1),f=!1):f=!0,b=!0),b},a.remove=function(b){var c=a.tags.splice(b,1)[0];return g.trigger("tag-removed",{$tag:c}),c},a.getCssClass=function(b){var c=b===a.tags.length-1;return f&&c?"selected":""},a.$watch(function(){return a.newTag.length>0},function(){f=!1}),this.registerAutocomplete=function(){var b=c.find("input");return b.on("keydown",function(a){g.trigger("input-keydown",a)}),a.newTagChange=function(){g.trigger("input-changed",a.newTag)},{tryAddTag:function(b){return a.newTag=b,a.tryAdd()},focusInput:function(){b[0].focus()},getTags:function(){return a.tags},on:function(a,b){return g.on(a,b),this}}}}],link:function(d,e){var f=[a.enter,a.comma,a.space,a.backspace],g=e.find("input");g.on("keydown",function(b){if(!b.isImmediatePropagationStopped||!b.isImmediatePropagationStopped()){var c=b.keyCode,e=b.shiftKey||b.altKey||b.ctrlKey||b.metaKey;e||-1===f.indexOf(c)||(c===a.enter&&d.options.addOnEnter||c===a.comma&&d.options.addOnComma||c===a.space&&d.options.addOnSpace?(d.tryAdd()&&d.$apply(),b.preventDefault()):c===a.backspace&&0===this.value.length&&d.tryRemoveLast()&&(d.$apply(),b.preventDefault()))}}).on("focus",function(){d.hasFocus||(d.hasFocus=!0,d.$apply())}).on("blur",function(){b(function(){var a=angular.element(c[0].activeElement).parent();a[0]!==e[0]&&(d.hasFocus=!1,d.options.addOnBlur&&d.tryAdd(),d.$apply())},0,!1)}),e.find("div").on("click",function(){g[0].focus()})}}}]),b.directive("autoComplete",["$document","$timeout","$sce","tagsInputConfig",function(b,c,d,e){function f(a,b){var d,e,f,g={};return e=function(a,b){var c=[];return a.forEach(function(a){-1===b.indexOf(a)&&c.push(a)}),c},g.reset=function(){f=null,g.items=[],g.visible=!1,g.index=-1,g.selected=null,g.query=null,c.cancel(d)},g.show=function(){g.selected=null,g.visible=!0},g.hide=function(){g.visible=!1},g.load=function(h,i){return h.length<b.minLength?(g.reset(),void 0):(c.cancel(d),d=c(function(){g.query=h;var b=a({$query:h});f=b,b.then(function(a){b===f&&(g.items=e(a,i),g.items.length>0&&g.show())})},b.debounceDelay,!1),void 0)},g.selectNext=function(){g.select(++g.index)},g.selectPrior=function(){g.select(--g.index)},g.select=function(a){0>a?a=g.items.length-1:a>=g.items.length&&(a=0),g.index=a,g.selected=g.items[a]},g.reset(),g}function g(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return{restrict:"E",require:"?^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",link:function(c,h,i,j){var k,l,m,n=[a.enter,a.tab,a.escape,a.up,a.down];e.load(c,i,{debounceDelay:{type:Number,defaultValue:100},minLength:{type:Number,defaultValue:3},highlightMatchedText:{type:Boolean,defaultValue:!0},maxResultsToShow:{type:Number,defaultValue:10}}),l=j.registerAutocomplete(),k=new f(c.source,c.options),m=c.options.highlightMatchedText?function(a,b){var c=new RegExp(b,"gi");return a.replace(c,"**$&**")}:function(a){return a},c.suggestionList=k,c.addSuggestion=function(){var a=!1;return k.selected&&(l.tryAddTag(k.selected),k.reset(),l.focusInput(),a=!0),a},c.highlight=function(a){return a=m(a,k.query),a=g(a),a=a.replace(/\*\*(.+?)\*\*/g,"<em>$1</em>"),d.trustAsHtml(a)},l.on("input-changed",function(a){a?k.load(a,l.getTags()):k.reset()}).on("input-keydown",function(b){var d,e;if(-1!==n.indexOf(b.keyCode)){var f=!1;b.stopImmediatePropagation=function(){f=!0,b.stopPropagation()},b.isImmediatePropagationStopped=function(){return f},k.visible&&(d=b.keyCode,e=!1,d===a.down?(k.selectNext(),e=!0):d===a.up?(k.selectPrior(),e=!0):d===a.escape?(k.reset(),e=!0):(d===a.enter||d===a.tab)&&(e=c.addSuggestion()),e&&(b.preventDefault(),b.stopImmediatePropagation(),c.$apply()))}}),b.on("click",function(){k.visible&&(k.reset(),c.$apply())})}}}]),b.directive("transcludeAppend",function(){return function(a,b,c,d,e){e(function(a){b.append(a)})}}),b.service("tagsInputConfig",["$interpolate",function(a){this.load=function(b,c,d){var e={};e[String]=function(a){return a},e[Number]=function(a){return parseInt(a,10)},e[Boolean]=function(a){return"true"===a},e[RegExp]=function(a){return new RegExp(a)},b.options={},angular.forEach(d,function(f,g){var h=c[g]&&a(c[g])(b.$parent),i=e[d[g].type];b.options[g]=h?i(h):d[g].defaultValue})}}]),b.run(["$templateCache",function(a){a.put("ngTagsInput/tags-input.html",'<div class="ngTagsInput" tabindex="-1" ng-class="options.customClass" transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul><li ng-repeat="tag in tags" ng-class="getCssClass($index)"><span>{{tag}}</span> <button type="button" ng-click="remove($index)">{{options.removeTagSymbol}}</button></li></ul><input placeholder="{{options.placeholder}}" size="{{options.placeholder.length}}" maxlength="{{options.maxLength}}" tabindex="{{options.tabindex}}" ng-model="newTag" ng-change="newTagChange()"></div></div>'),a.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul><li ng-repeat="item in suggestionList.items | limitTo:options.maxResultsToShow" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"></li></ul></div>')}])}();